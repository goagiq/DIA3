<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title|default('Advanced Analysis Report') }}</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .header h1 {
            font-size: 3rem;
            color: #2c3e50;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .header .subtitle {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .section h2 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .section h3 {
            color: #2c3e50;
            font-size: 1.5rem;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .metric-details {
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .status-level, .trend-level {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            margin: 2px;
            font-size: 0.8em;
        }
        
        .status-level {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .trend-level {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .chart-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        
        .implications-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }
        
        .implication-column h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .implications-list {
            list-style: none;
        }
        
        .implications-list li {
            background: rgba(52, 152, 219, 0.1);
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .implications-list li:hover {
            background: rgba(52, 152, 219, 0.2);
        }
        
        .implications-list li strong {
            color: #2c3e50;
            display: block;
            margin-bottom: 5px;
        }
        
        .implications-list li p {
            color: #555;
            margin-bottom: 8px;
        }
        
        .impact-level {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .impact-level:contains("High") {
            background: #e74c3c;
            color: white;
        }
        
        .impact-level:contains("Medium") {
            background: #f39c12;
            color: white;
        }
        
        .impact-level:contains("Low") {
            background: #27ae60;
            color: white;
        }
        
        .data-sources {
            margin-top: 30px;
            padding: 20px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 15px;
        }
        
        .data-sources h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .sources-list {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .sources-list li {
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #555;
        }
        
        .recommendations-section {
            margin-top: 30px;
        }
        
        .recommendations-list {
            list-style: none;
        }
        
        .recommendation-item {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            margin-bottom: 15px;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .recommendation-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        /* Enhanced Tooltip Styles */
        #enhancedTooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            z-index: 10000;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        #enhancedTooltip h4 {
            color: #3498db;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        #enhancedTooltip .tooltip-content {
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        #enhancedTooltip .tooltip-source {
            background: rgba(52, 152, 219, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        
        #enhancedTooltip .tooltip-strategic {
            background: rgba(231, 76, 60, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        
        #enhancedTooltip .tooltip-recommendations {
            background: rgba(46, 204, 113, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        
        #enhancedTooltip .tooltip-use-cases {
            background: rgba(155, 89, 182, 0.2);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9em;
        }
        
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .module-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        
        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .module-card h3 {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 15px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .module-card p {
            color: #555;
            margin-bottom: 15px;
        }
        
        /* Module Detail Modal */
        .module-modal {
            display: none;
            position: fixed;
            z-index: 10001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 1200px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .charts-grid { grid-template-columns: 1fr; }
            .implications-grid { grid-template-columns: 1fr; }
            .sources-list { grid-template-columns: 1fr; }
            .module-grid { grid-template-columns: 1fr; }
            .modal-content { width: 95%; margin: 2% auto; }
        }
    </style>

<style>
/* Python System CSS Styles */
.static-chart, .static-visualization {
    text-align: center;
    margin: 20px 0;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background: #f9f9f9;
}

.chart-image, .viz-image {
    max-width: 100%;
    height: auto;
    border-radius: 3px;
}

/* CSS Tooltips */
.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip .tooltiptext {
    visibility: hidden;
    width: 200px;
    background-color: #555;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 5px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
}

.tooltip:hover .tooltiptext {
    visibility: visible;
    opacity: 1;
}

/* Responsive Design */
@media (max-width: 768px) {
    .static-chart, .static-visualization {
        margin: 10px 0;
        padding: 5px;
    }
}
</style>

</head>
<body>
    
    <div class="container">
        <div class="header">
            <h1>{{ header_title|default('📊 Advanced Analysis Report') }}</h1>
            <div class="subtitle">{{ header_subtitle|default('Enhanced Analysis with Advanced Tooltips and Multiple Sources') }}</div>
            <div class="timestamp">Generated: {{ timestamp|default('August 24, 2025 at 07:52 AM') }}</div>
        </div>
        
        <!-- Executive Summary Section -->
        <div class="section">
            <h2>🎯 Executive Summary</h2>
            <p>{{ executive_summary|default('Comprehensive analysis using advanced analytical frameworks and specialized modules. This report provides strategic insights, risk assessments, and actionable recommendations based on multi-source intelligence and expert analysis.') }}</p>
            
            <div class="metrics-grid">
                {% for metric in metrics %}
                <div class="metric-card">
                    <div class="metric-value">{{ metric.value }}</div>
                    <div class="metric-label">{{ metric.label }}</div>
                    {% if metric.details %}
                    <div class="metric-details">{{ metric.details }}</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Analysis Modules Section -->
        <div class="section">
            <h2>📋 Analysis Modules</h2>
            <p>{{ modules_description|default('Click on any module card to view detailed analysis with interactive visualizations and comprehensive data.') }}</p>
            <div class="module-grid">
                {% for module in modules %}
                <div class="module-card" 
                     onclick="showModuleDetails('{{ module.id }}', '{{ module.title }}', '{{ module.description }}', '{{ module.source|safe }}', '{{ module.strategic_impact|safe }}', '{{ module.recommendations|safe }}', '{{ module.use_cases|safe }}')">
                    <h3>{{ module.number }}. {{ module.title }}</h3>
                    <p>{{ module.description }}</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Additional Sections -->
        {% if implications %}
        <div class="section">
            <h2>🔍 Strategic Implications</h2>
            <div class="implications-grid">
                {% for implication in implications %}
                <div class="implication-column">
                    <h4>{{ implication.title }}</h4>
                    <ul class="implications-list">
                        {% for item in implication.items %}
                        <li>
                            <strong>{{ item.title }}</strong>
                            <p>{{ item.description }}</p>
                            <span class="impact-level">{{ item.impact_level }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if recommendations %}
        <div class="section">
            <h2>💡 Strategic Recommendations</h2>
            <div class="recommendations-section">
                <ul class="recommendations-list">
                    {% for recommendation in recommendations %}
                    <li class="recommendation-item">
                        <strong>{{ recommendation.title }}</strong>
                        <p>{{ recommendation.description }}</p>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}

        {% if data_sources %}
        <div class="section">
            <h2>📊 Data Sources</h2>
            <div class="data-sources">
                <h4>Sources Used in Analysis</h4>
                <ul class="sources-list">
                    {% for source in data_sources %}
                    <li>{{ source }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}

        {% if charts %}
        <div class="section">
            <h2>📈 Analysis Charts</h2>
            <div class="charts-grid">
                {% for chart in charts %}
                <div class="chart-section">
                    <h3>{{ chart.title }}</h3>
                    <div class="chart-container">
                        <canvas id="{{ chart.id }}"></canvas>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Enhanced Tooltip -->
    <div id="enhancedTooltip">
        <h4 id="tooltipTitle"></h4>
        <div class="tooltip-content" id="tooltipContent"></div>
        <div class="tooltip-source" id="tooltipSource"></div>
        <div class="tooltip-strategic" id="tooltipStrategic"></div>
        <div class="tooltip-recommendations" id="tooltipRecommendations"></div>
        <div class="tooltip-use-cases" id="tooltipUseCases"></div>
    </div>
    
    <!-- Module Detail Modal -->
    <div id="moduleModal" class="module-modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // Enhanced Tooltip System
        const tooltip = document.getElementById('enhancedTooltip');
        const tooltipTitle = document.getElementById('tooltipTitle');
        const tooltipContent = document.getElementById('tooltipContent');
        const tooltipSource = document.getElementById('tooltipSource');
        const tooltipStrategic = document.getElementById('tooltipStrategic');
        const tooltipRecommendations = document.getElementById('tooltipRecommendations');
        const tooltipUseCases = document.getElementById('tooltipUseCases');

        function showTooltip(event, title, content, source, strategic, recommendations, useCases) {
            tooltipTitle.innerHTML = title;
            tooltipContent.innerHTML = content;
            tooltipSource.innerHTML = source;
            tooltipStrategic.innerHTML = strategic;
            tooltipRecommendations.innerHTML = recommendations;
            tooltipUseCases.innerHTML = useCases;
            
            tooltip.style.display = 'block';
            tooltip.style.left = event.pageX + 10 + 'px';
            tooltip.style.top = event.pageY - 10 + 'px';
        }

        function hideTooltip() {
            tooltip.style.display = 'none';
        }

        // Module Details Modal
        const modal = document.getElementById('moduleModal');
        const modalContent = document.getElementById('modalContent');
        const closeBtn = document.querySelector('.close');

        function showModuleDetails(id, title, description, source, strategic, recommendations, useCases) {
            modalContent.innerHTML = `
                <h2>${title}</h2>
                <p><strong>Description:</strong> ${description}</p>
                <div class="tooltip-source">${source}</div>
                <div class="tooltip-strategic">${strategic}</div>
                <div class="tooltip-recommendations">${recommendations}</div>
                <div class="tooltip-use-cases">${useCases}</div>
            `;
            modal.style.display = 'block';
        }

        closeBtn.onclick = function() {
            modal.style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Chart.js Integration (if charts are provided)
        {% if charts %}
        document.addEventListener('DOMContentLoaded', function() {
            {% for chart in charts %}
            const ctx{{ loop.index }} = document.getElementById('{{ chart.id }}').getContext('2d');
            new Chart(ctx{{ loop.index }}, {
                type: '{{ chart.type|default("bar") }}',
                data: {{ chart.data|tojson }},
                options: {{ chart.options|tojson }}
            });
            {% endfor %}
        });
        {% endif %}
    </script>
</body>
</html>
