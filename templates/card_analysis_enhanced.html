<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title|default('Card Analysis - Enhanced Report') }}</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .header h1 {
            font-size: 3rem;
            color: #2c3e50;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .header .subtitle {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .section h2 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .section h3 {
            color: #2c3e50;
            font-size: 1.5rem;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .metric-details {
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .status-level, .trend-level {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            margin: 2px;
            font-size: 0.8em;
        }
        
        .status-level {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .trend-level {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .chart-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        
        .implications-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }
        
        .implication-column h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .implications-list {
            list-style: none;
        }
        
        .implications-list li {
            background: rgba(52, 152, 219, 0.1);
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .implications-list li:hover {
            background: rgba(52, 152, 219, 0.2);
        }
        
        .implications-list li strong {
            color: #2c3e50;
            display: block;
            margin-bottom: 5px;
        }
        
        .implications-list li p {
            color: #555;
            margin-bottom: 8px;
        }
        
        .impact-level {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .impact-high {
            background: #e74c3c;
            color: white;
        }
        
        .impact-medium {
            background: #f39c12;
            color: white;
        }
        
        .impact-low {
            background: #27ae60;
            color: white;
        }
        
        .data-sources {
            margin-top: 30px;
            padding: 20px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 15px;
        }
        
        .data-sources h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .sources-list {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .sources-list li {
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #555;
        }
        
        .recommendations-section {
            margin-top: 30px;
        }
        
        .recommendations-list {
            list-style: none;
        }
        
        .recommendation-item {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            margin-bottom: 15px;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .recommendation-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        /* Enhanced Tooltip Styles */
        .advanced-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            max-width: 450px;
            z-index: 10000;
            display: none;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
        }
        
        .advanced-tooltip h4 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .advanced-tooltip .tooltip-section {
            margin-bottom: 15px;
        }
        
        .advanced-tooltip .tooltip-section-title {
            color: #f39c12;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .advanced-tooltip .tooltip-content {
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .advanced-tooltip .tooltip-sources {
            background: rgba(52, 152, 219, 0.2);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.9em;
        }
        
        .advanced-tooltip .tooltip-use-cases {
            background: rgba(46, 204, 113, 0.2);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.9em;
        }
        
        .advanced-tooltip .tooltip-recommendations {
            background: rgba(231, 76, 60, 0.2);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.9em;
        }
        
        .advanced-tooltip .tooltip-list {
            list-style: none;
            padding-left: 0;
        }
        
        .advanced-tooltip .tooltip-list li {
            margin-bottom: 5px;
            padding-left: 15px;
            position: relative;
        }
        
        .advanced-tooltip .tooltip-list li:before {
            content: "•";
            color: #3498db;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        .tooltip-trigger {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tooltip-trigger:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .module-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        
        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        /* Conclusion Section Styles */
        .conclusion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }

        .conclusion-column {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #3498db;
        }

        .conclusion-column h3 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .conclusion-column p {
            color: #555;
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .final-recommendations {
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
        }

        .final-recommendations h3 {
            color: white;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .future-outlook {
            margin: 30px 0;
            padding: 25px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 15px;
            border-left: 5px solid #3498db;
        }

        .future-outlook h3 {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 15px;
        }

        .future-outlook p {
            color: #555;
            line-height: 1.7;
            font-size: 1.1em;
        }
        
        .module-card h3 {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 15px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .module-card p {
            color: #555;
            margin-bottom: 15px;
        }
        
        /* Module Detail Modal */
        .module-modal {
            display: none;
            position: fixed;
            z-index: 10001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 1200px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .charts-grid { grid-template-columns: 1fr; }
            .implications-grid { grid-template-columns: 1fr; }
            .sources-list { grid-template-columns: 1fr; }
            .module-grid { grid-template-columns: 1fr; }
            .modal-content { width: 95%; margin: 2% auto; }
        }
    </style>

    <style>
    /* Python System CSS Styles */
    .static-chart, .static-visualization {
        text-align: center;
        margin: 20px 0;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background: #f9f9f9;
    }

    .chart-image, .viz-image {
        max-width: 100%;
        height: auto;
        border-radius: 3px;
    }

    /* CSS Tooltips */
    .tooltip {
        position: relative;
        display: inline-block;
    }

    .tooltip .tooltiptext {
        visibility: hidden;
        width: 200px;
        background-color: #555;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -100px;
        opacity: 0;
        transition: opacity 0.3s;
    }

    .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .static-chart, .static-visualization {
            margin: 10px 0;
            padding: 5px;
        }
    }
    </style>

</head>
<body>
    
    <div class="container">
        <div class="header">
            <h1>{{ header_title|default('🚢 Analysis Report') }}</h1>
            <div class="subtitle">{{ header_subtitle|default('Comprehensive Strategic Assessment with Enhanced Tooltips and Multi-Source Intelligence') }}</div>
            {% if timestamp %}
            <div class="timestamp">Generated: {{ timestamp }}</div>
            {% endif %}
        </div>
        
        <!-- Executive Summary Section -->
        {% if executive_summary %}
        <div class="section">
            <h2>🎯 Executive Summary</h2>
            <p>{{ executive_summary.description }}</p>
            
            {% if executive_summary.metrics %}
            <div class="metrics-grid">
                {% for metric in executive_summary.metrics %}
                <div class="metric-card tooltip-trigger" data-tooltip="{{ metric.tooltip|default('default_tooltip') }}">
                    <div class="metric-value">{{ metric.value }}</div>
                    <div class="metric-label">{{ metric.label }}</div>
                    <div class="metric-details">{{ metric.details }}</div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Analysis Modules Section -->
        {% if modules %}
        <div class="section">
            <h2>📋 Analysis Modules</h2>
            <p>{{ modules_description|default('Click on any module card to view detailed analysis with interactive visualizations and comprehensive data.') }}</p>
            <div class="module-grid">
                {% for module in modules %}
                <div class="module-card tooltip-trigger" data-tooltip="{{ module.tooltip|default('default_tooltip') }}">
                    <h3>{{ module.number }}. {{ module.title }}</h3>
                    <p>{{ module.description }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Deterrence Enhancement Analysis Section -->
        {% if deterrence_analysis %}
        <div class="section">
            <h2>🛡️ Deterrence Enhancement Analysis</h2>
            <p>{{ deterrence_analysis.description }}</p>
            
            <div class="module-grid">
                {% for deterrence_module in deterrence_analysis.modules %}
                <div class="module-card tooltip-trigger" data-tooltip="{{ deterrence_module.tooltip|default('deterrence_enhancement') }}">
                    <h3>{{ deterrence_module.title }}</h3>
                    {% for paragraph in deterrence_module.content %}
                    <p>{{ paragraph|safe }}</p>
                    {% endfor %}
                    <span class="impact-level impact-{{ deterrence_module.impact_level }}">{{ deterrence_module.impact_label }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Strategic Implications Section -->
        {% if strategic_implications %}
        <div class="section">
            <h2>🔍 Strategic Implications</h2>
            <div class="implications-grid">
                {% for implication in strategic_implications %}
                <div class="implication-column">
                    <h4>{{ implication.title }}</h4>
                    <ul class="implications-list">
                        {% for item in implication.items %}
                        <li>
                            <strong>{{ item.title }}</strong>
                            <p>{{ item.description }}</p>
                            <span class="impact-level impact-{{ item.impact_level }}">{{ item.impact_label }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}


        <!-- Data Sources Section -->
        {% if data_sources %}
        <div class="section">
            <h2>📊 Data Sources</h2>
            <div class="data-sources">
                <h4>{{ data_sources.title|default('Sources Used in Analysis') }}</h4>
                <ul class="sources-list">
                    {% for source in data_sources.sources %}
                    <li>{{ source }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}

        <!-- Conclusion Section -->
        {% if conclusion %}
        <div class="section">
            <h2>🎯 Executive Conclusion</h2>
            <p>{{ conclusion.description }}</p>
            
            <div class="conclusion-grid">
                {% for column in conclusion.columns %}
                <div class="conclusion-column">
                    <h3>{{ column.icon|default('📊') }} {{ column.title }}</h3>
                    {% for paragraph in column.content %}
                    <p>{{ paragraph|safe }}</p>
                    {% endfor %}
                    <span class="impact-level impact-{{ column.impact_level }}">{{ column.impact_label }}</span>
                </div>
                {% endfor %}
            </div>
            
            {% if conclusion.final_recommendations %}
            <div class="final-recommendations">
                <h3>🎯 {{ conclusion.final_recommendations.title|default('Key Strategic Recommendations') }}</h3>
                <div class="recommendations-grid">
                    {% for rec in conclusion.final_recommendations.items %}
                    <div class="recommendation-item">
                        <strong>{{ rec.title }}:</strong> {{ rec.content }}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            {% if conclusion.future_outlook %}
            <div class="future-outlook">
                <h3>🔮 {{ conclusion.future_outlook.title|default('Future Outlook') }}</h3>
                <p>{{ conclusion.future_outlook.content }}</p>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Analysis Charts Section -->
        {% if charts %}
        <div class="section">
            <h2>📈 Analysis Charts</h2>
            <div class="charts-grid">
                {% for chart in charts %}
                <div class="chart-section tooltip-trigger" data-tooltip="{{ chart.tooltip|default('default_tooltip') }}">
                    <h3>{{ chart.title }}</h3>
                    <div class="chart-container">
                        <div class="static-chart">
                            {{ chart.content|safe }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Advanced Tooltips -->
    {% if tooltips %}
    {% for tooltip in tooltips %}
    <div id="{{ tooltip.id }}" class="advanced-tooltip">
        <h4>{{ tooltip.title }}</h4>
        <div class="tooltip-section">
            <div class="tooltip-section-title">Description</div>
            <div class="tooltip-content">{{ tooltip.description }}</div>
        </div>
        {% if tooltip.sources %}
        <div class="tooltip-section">
            <div class="tooltip-section-title">Sources</div>
            <div class="tooltip-sources">
                <ul class="tooltip-list">
                    {% for source in tooltip.sources %}
                    <li>{{ source }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}
        {% if tooltip.use_cases %}
        <div class="tooltip-section">
            <div class="tooltip-section-title">Use Cases</div>
            <div class="tooltip-use-cases">
                <ul class="tooltip-list">
                    {% for use_case in tooltip.use_cases %}
                    <li>{{ use_case }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}
        {% if tooltip.recommendations %}
        <div class="tooltip-section">
            <div class="tooltip-section-title">Recommendations</div>
            <div class="tooltip-recommendations">
                <ul class="tooltip-list">
                    {% for rec in tooltip.recommendations %}
                    <li>{{ rec }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}
    </div>
    {% endfor %}
    {% endif %}

    <script>
        // Advanced Tooltip System
        class AdvancedTooltipManager {
            constructor() {
                this.activeTooltip = null;
                this.init();
            }
            
            init() {
                // Add event listeners to tooltip triggers
                document.addEventListener('DOMContentLoaded', () => {
                    this.setupTooltipTriggers();
                    this.setupGlobalEventListeners();
                });
            }
            
            setupTooltipTriggers() {
                const triggers = document.querySelectorAll('.tooltip-trigger');
                triggers.forEach(trigger => {
                    trigger.addEventListener('mouseenter', (e) => this.showTooltip(e));
                    trigger.addEventListener('mouseleave', (e) => this.hideTooltip(e));
                });
            }
            
            setupGlobalEventListeners() {
                document.addEventListener('mousemove', (e) => this.updateTooltipPosition(e));
                document.addEventListener('scroll', () => this.hideAllTooltips());
            }
            
            showTooltip(event) {
                const trigger = event.currentTarget;
                const tooltipId = trigger.getAttribute('data-tooltip');
                const tooltip = document.getElementById(tooltipId);
                
                if (tooltip) {
                    this.activeTooltip = tooltip;
                    tooltip.style.display = 'block';
                    this.updateTooltipPosition(event);
                }
            }
            
            hideTooltip(event) {
                const trigger = event.currentTarget;
                const tooltipId = trigger.getAttribute('data-tooltip');
                const tooltip = document.getElementById(tooltipId);
                
                if (tooltip) {
                    setTimeout(() => {
                        if (!tooltip.matches(':hover')) {
                            tooltip.style.display = 'none';
                            this.activeTooltip = null;
                        }
                    }, 100);
                }
            }
            
            updateTooltipPosition(event) {
                if (this.activeTooltip) {
                    const tooltip = this.activeTooltip;
                    const rect = tooltip.getBoundingClientRect();
                    const viewportWidth = window.innerWidth;
                    const viewportHeight = window.innerHeight;
                    
                    let x = event.clientX + 15;
                    let y = event.clientY - 15;
                    
                    // Adjust position if tooltip would go off-screen
                    if (x + rect.width > viewportWidth - 20) {
                        x = event.clientX - rect.width - 15;
                    }
                    
                    if (y + rect.height > viewportHeight - 20) {
                        y = event.clientY - rect.height - 15;
                    }
                    
                    // Ensure tooltip stays within viewport
                    x = Math.max(10, Math.min(x, viewportWidth - rect.width - 10));
                    y = Math.max(10, Math.min(y, viewportHeight - rect.height - 10));
                    
                    tooltip.style.left = x + 'px';
                    tooltip.style.top = y + 'px';
                }
            }
            
            hideAllTooltips() {
                const tooltips = document.querySelectorAll('.advanced-tooltip');
                tooltips.forEach(tooltip => {
                    tooltip.style.display = 'none';
                });
                this.activeTooltip = null;
            }
        }
        
        // Initialize tooltip manager
        const tooltipManager = new AdvancedTooltipManager();
    </script>
</body>
</html>
